---
- name: Check database connectivity
  mysql_db:
    login_user: "{{ database.user }}"
    login_password: "{{ database.password }}"
    login_host: "{{ database.host }}"
    login_port: "{{ database.port }}"
    name: "{{ database.name }}"
  register: db_result
  until: db_result is succeeded
  retries: 10
  delay: 10

- name: Test for running nginx
  shell: ps axuf|grep 'nginx'|grep -v "grep" | tr -d "\n" | cat

- name: Test service on port 80
  shell: netstat -tunlp | grep ":80 " | sed -e 's/.*\///'

- name: Test service on port 443
  shell: netstat -tunlp | grep ":443 " | sed -e 's/.*\///'

- name: Check that Freescout runs
  uri:
    url: "{{ url }}"
    status_code: [200, 202]
    validate_certs: no
